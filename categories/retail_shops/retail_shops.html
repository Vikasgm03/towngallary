<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Shops & Markets | Vihara</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ---------- VARIABLES ---------- */
    :root {
      --primary: #FF9933;
      --text-dark: #2c3e50;
      --text-light: #666;
      --bg-body: #f8f9fa;
      --card-bg: #ffffff;
      --success: #2e7d32;
      --danger: #c62828;
      --radius: 16px; /* Slightly sharper corners for boxy look */
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Poppins', sans-serif; background: var(--bg-body); color: var(--text-dark); min-height: 100vh; display: flex; flex-direction: column; }

    /* ---------- HEADER ---------- */
    header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 5%;
      position: sticky; top: 0; z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.03);
      display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .back-nav { text-decoration: none; color: var(--text-dark); font-weight: 500; font-size: 0.9rem; padding: 8px 16px; border-radius: 50px; background: #eee; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
    .back-nav:hover { background: var(--primary); color: white; }

    /* ---------- SEARCH ---------- */
    .search-section { text-align: center; padding: 3rem 1rem 2rem; background: white; border-radius: 0 0 30px 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); margin-bottom: 20px; }
    .search-section h2 { font-family: 'Playfair Display', serif; font-size: 2rem; margin-bottom: 0.5rem; color: var(--text-dark); }
    .search-bar-container { max-width: 500px; margin: 1.5rem auto 0; position: relative; }
    .search-input { width: 100%; padding: 15px 20px 15px 50px; border: 2px solid #eee; border-radius: 50px; font-size: 1rem; outline: none; transition: 0.3s; background: #f9f9f9; }
    .search-input:focus { border-color: var(--primary); background: #fff; box-shadow: 0 5px 20px rgba(255, 153, 51, 0.2); }
    .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: #aaa; }

    /* ---------- UPDATED GRID SYSTEM ---------- */
    .grid-container { 
      max-width: 1200px; 
      margin: 0 auto 2rem; 
      padding: 0 20px; 
      display: grid; 
      /* Make items smaller (250px min) to fit more in a row = Boxy look */
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); 
      gap: 25px; 
    }

    .shop-card {
      background: var(--card-bg); 
      border-radius: var(--radius); 
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
      transition: transform 0.3s, box-shadow 0.3s;
      position: relative; 
      border: 1px solid #eee; 
      display: flex; 
      flex-direction: column;
      text-decoration: none; 
      color: inherit; 
      opacity: 0; 
      animation: fadeUp 0.6s ease forwards;
      height: 100%; /* Ensure full height */
    }

    .shop-card:hover { 
      transform: translateY(-5px); 
      box-shadow: 0 12px 25px rgba(0,0,0,0.1); 
      border-color: var(--primary); 
    }

    /* Boxy Image Aspect Ratio */
    .img-wrapper { 
      width: 100%; 
      aspect-ratio: 4/3; /* Keeps image shape consistent */
      overflow: hidden; 
      position: relative; 
      background: #eee; 
    }
    .img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; }
    .shop-card:hover .img-wrapper img { transform: scale(1.1); }

    .card-content { padding: 1.2rem; display: flex; flex-direction: column; flex: 1; }
    
    .shop-header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
    .shop-card h3 { font-size: 1.1rem; font-weight: 600; color: var(--text-dark); margin: 0; line-height: 1.3; }
    
    .rating-badge { background: #2e7d32; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 4px; height: fit-content;}
    .rating-badge i { font-size: 0.65rem; }

    /* Status Tags */
    .status-row { display: flex; align-items: center; gap: 8px; font-size: 0.75rem; margin: 8px 0 12px; }
    .status-open { color: var(--success); font-weight: 600; background: #e8f5e9; padding: 3px 8px; border-radius: 4px; }
    .status-closed { color: var(--danger); font-weight: 600; background: #ffebee; padding: 3px 8px; border-radius: 4px; }
    .time-info { color: #888; }

    .shop-desc { 
      font-size: 0.85rem; 
      color: var(--text-light); 
      line-height: 1.5; 
      margin-bottom: 15px; 
      display: -webkit-box; 
      -webkit-line-clamp: 2; 
      -webkit-box-orient: vertical; 
      overflow: hidden; 
      flex-grow: 1; 
    }

    .action-btn { 
      display: block; 
      width: 100%; 
      text-align: center; 
      padding: 10px; 
      background: #f4f6f8; /* Softer button style */
      color: var(--text-dark); 
      border-radius: 8px; 
      font-size: 0.85rem;
      font-weight: 600; 
      transition: 0.3s; 
      margin-top: auto; 
    }
    .shop-card:hover .action-btn { background: var(--primary); color: white; }

    /* Footer & Loader */
    .loader { text-align: center; margin-top: 50px; font-size: 1.2rem; color: var(--text-light); }
    footer { text-align: center; padding: 2rem; margin-top: auto; font-size: 0.85rem; color: #999; }
    @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    
    /* MOBILE ADJUSTMENTS */
    @media(max-width: 600px) { 
      .search-section h2 { font-size: 1.5rem; } 
      .grid-container { 
        grid-template-columns: 1fr; /* Full width on mobile */
      } 
      .img-wrapper { aspect-ratio: 16/9; } /* Wider images on mobile look better */
    }
  </style>
</head>

<body>

  <header>
    <div class="brand"><i class="fas fa-store"></i> Retail Shops</div>
    <a href="../../index.html" class="back-nav"><i class="fas fa-arrow-left"></i> Back</a>
  </header>

  <section class="search-section">
    <h2>Discover Local Stores</h2>
    <p style="color: #888; font-size: 0.95rem;">Find gifts, clothes, and general stores</p>
    <div class="search-bar-container">
      <i class="fas fa-search search-icon"></i>
      <input type="text" id="searchInput" class="search-input" placeholder="Search for 'Gifts', 'General Store'...">
    </div>
  </section>

  <main>
    <div id="loading" class="loader"><i class="fas fa-spinner fa-spin"></i> Loading shops...</div>
    <div class="grid-container" id="shopGrid">
      </div>
  </main>

  <footer>
    <p>© 2025 Vihara | Shops & Markets</p>
  </footer>

  <script>
    let allShops = [];

    // 1. Fetch JSON Data
    fetch('retail_shops.json')
      .then(response => response.json())
      .then(data => {
        allShops = data;
        document.getElementById('loading').style.display = 'none';
        renderShops(allShops);
      })
      .catch(err => {
        console.error('Error loading shops:', err);
        document.getElementById('loading').innerHTML = "<p>Failed to load data.</p>";
      });

    // 2. Render Function
    function renderShops(shops) {
      const grid = document.getElementById('shopGrid');
      grid.innerHTML = ''; 

      if(shops.length === 0) {
        grid.innerHTML = '<p style="text-align:center; width:100%; color:#888;">No shops found matching your search.</p>';
        return;
      }

      const now = new Date();
      const currentVal = now.getHours() + (now.getMinutes() / 60);

      shops.forEach((shop, index) => {
        // Time Logic
        const openVal = parseInt(shop.openTime.split(':')[0]) + (parseInt(shop.openTime.split(':')[1])/60);
        const closeVal = parseInt(shop.closeTime.split(':')[0]) + (parseInt(shop.closeTime.split(':')[1])/60);
        let isOpen = (currentVal >= openVal && currentVal < closeVal);
        
        let statusHtml = isOpen 
          ? `<span class="status-open">Open Now</span>` 
          : `<span class="status-closed">Closed</span>`;

        // Card HTML
        const cardHTML = `
          <a href="retail_shops_details.html?id=${shop.id}" class="shop-card" style="animation-delay: ${index * 0.1}s">
            <div class="img-wrapper">
              <img src="${shop.image}" alt="${shop.name}" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
            </div>
            <div class="card-content">
              <div class="shop-header-row">
                <h3>${shop.name}</h3>
                <div class="rating-badge">${shop.rating} <i class="fas fa-star"></i></div>
              </div>
              <div class="status-row">
                ${statusHtml}
                <span class="time-info">• ${convertTo12Hour(shop.openTime)} - ${convertTo12Hour(shop.closeTime)}</span>
              </div>
              <p class="shop-desc">${shop.description}</p>
              <span class="action-btn">View Details <i class="fas fa-arrow-right"></i></span>
            </div>
          </a>
        `;
        grid.innerHTML += cardHTML;
      });
    }

    // Helper: 24h to 12h
    function convertTo12Hour(time) {
      if (!time) return "";
      let [hours, minutes] = time.split(':');
      let suffix = hours >= 12 ? "PM" : "AM";
      hours = hours % 12 || 12;
      return `${hours}:${minutes} ${suffix}`;
    }

    // 3. Search Filter
    document.getElementById('searchInput').addEventListener('keyup', (e) => {
      const term = e.target.value.toLowerCase();
      const filtered = allShops.filter(shop => 
        shop.name.toLowerCase().includes(term) || shop.description.toLowerCase().includes(term)
      );
      renderShops(filtered);
    });
  </script>

</body>
</html>
